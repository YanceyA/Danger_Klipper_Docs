# This file contains common pin mappings for the WeAct Blackpill STM32F411
# development board. To use this config, compile the firmware for an
# STM32F411 with a USB (on PA11/PA12) or serial (USART1 PA9/PA10)
# interface. Select "No bootloader" when flashing via the ROM DFU
# loader, or a 16KiB offset when flashing the STM32 HID bootloader.
#
# The "make flash" command will not automatically place the board into
# DFU mode. Use the BOOT0 button (or jumper) while tapping NRST to enter
# the system bootloader before running "make flash" or dfu-util. See
# docs/MCU_WeAct_Blackpill.md for full flashing instructions.
#
# By default this configuration assumes external stepper drivers,
# heaters, and fans are connected to the Blackpill header pins indicated
# below. All GPIO operate at 3.3V and are not 5V tolerant.
#
# See docs/Config_Reference.md for a description of parameters.

[stepper_x]
step_pin: PB10
dir_pin: PB2
enable_pin: !PB12
microsteps: 16
rotation_distance: 40
endstop_pin: ^PC13
position_endstop: 0
position_max: 200
homing_speed: 50

[stepper_y]
step_pin: PB0
dir_pin: PB1
enable_pin: !PB13
microsteps: 16
rotation_distance: 40
endstop_pin: ^PC14
position_endstop: 0
position_max: 200
homing_speed: 50

[stepper_z]
step_pin: PA6
dir_pin: PA7
enable_pin: !PB11
microsteps: 16
rotation_distance: 8
endstop_pin: ^PC15
position_endstop: 0.5
position_max: 200

[extruder]
step_pin: PA4
dir_pin: PA5
enable_pin: !PA15
microsteps: 16
rotation_distance: 33.500
nozzle_diameter: 0.400
filament_diameter: 1.750
heater_pin: PA8
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PA0
control: pid
pid_Kp: 22.2
pid_Ki: 1.08
pid_Kd: 114
min_temp: 0
max_temp: 250

[heater_bed]
heater_pin: PA9
sensor_type: ATC Semitec 104GT-2
sensor_pin: PA1
control: watermark
min_temp: 0
max_temp: 130

[fan]
pin: PA10

[heater_fan nozzle_cooling_fan]
pin: PB6
max_power: 1.0
shutdown_speed: 0

[temperature_sensor board]
sensor_type: temperature_mcu

[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32f411_if00

[printer]
kinematics: cartesian
max_velocity: 300
max_accel: 3000
max_z_velocity: 5
max_z_accel: 100

[board_pins]
aliases:
    # Left edge header (USB connector up, from top to bottom)
    J1_1=<VBAT>,  J1_2=<3V3>,  J1_3=<GND>,  J1_4=<5V>,
    J1_5=PC13,    J1_6=PC14,   J1_7=PC15,   J1_8=PA0,
    J1_9=PA1,     J1_10=PA2,   J1_11=PA3,   J1_12=PA4,
    J1_13=PA5,    J1_14=PA6,   J1_15=PA7,   J1_16=PB0,
    J1_17=PB1,    J1_18=PB2,   J1_19=PB10,  J1_20=PB11,
    J1_21=PB12,   J1_22=PB13,  J1_23=PB14,  J1_24=PB15,
    # Right edge header (USB connector up, from top to bottom)
    J2_1=VBUS,    J2_2=<3V3>,  J2_3=<GND>,  J2_4=<NRST>,
    J2_5=PA13,    J2_6=PA14,   J2_7=PA15,   J2_8=PB3,
    J2_9=PB4,     J2_10=PB5,   J2_11=PB6,   J2_12=PB7,
    J2_13=PB8,    J2_14=PB9,   J2_15=PA8,   J2_16=PA9,
    J2_17=PA10,   J2_18=PA11,  J2_19=PA12,  J2_20=PC6,
    J2_21=PC7,    J2_22=PC8,   J2_23=PC9,   J2_24=PC10

# Notes:
#  * PC6-PC10 are only available on hardware revision 3.1 and newer.
#  * BOOT0 and NRST buttons are located next to the USB connector.
#  * Use level shifting or external driver boards when interfacing with 5V logic.
